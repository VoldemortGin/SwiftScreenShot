# 全屏截图功能说明

## 概述
SwiftScreenShot 应用现在支持两种截图模式：
1. **区域截图**（原有功能）- 用户选择屏幕区域进行截图
2. **全屏截图**（新功能）- 直接捕获整个屏幕，无需选择

## 功能特性

### 1. 截图模式
- **区域截图**: 按下快捷键后显示选择界面，用户拖拽选择截图区域
- **全屏截图**: 按下快捷键后立即截取整个屏幕，无需用户交互

### 2. 快捷键
- **区域截图**: `⌃⌘A` (Control + Command + A)
- **全屏截图**: `⇧⌘3` (Shift + Command + 3)

### 3. 多显示器支持
全屏截图支持三种模式，可在设置中配置：

#### 主显示器模式
- 仅捕获主显示器（通常是带有菜单栏的屏幕）
- 适用场景：单显示器或只需要主屏幕内容

#### 当前屏幕模式（默认）
- 捕获鼠标光标所在的屏幕
- 适用场景：多显示器环境，需要灵活选择屏幕

#### 所有屏幕模式
- 捕获所有连接的显示器，并将它们拼接成一张图片
- 保持各显示器的相对位置关系
- 适用场景：需要完整的多屏幕布局截图

### 4. 菜单栏
菜单栏中新增两个选项：
- **区域截图 (⌃⌘A)** - 触发区域选择截图
- **全屏截图 (⇧⌘3)** - 触发全屏截图

### 5. 设置界面
在设置窗口中新增"全屏截图设置"部分：
- **全屏截图模式选择器**: 分段控件，可选择主显示器/当前屏幕/所有屏幕
- **说明文字**: 详细解释每种模式的含义
- 设置会自动保存到 UserDefaults

## 技术实现

### 新增文件
1. **ScreenshotMode.swift**
   - `ScreenshotMode` 枚举：定义截图模式（region, fullScreen, allScreens）
   - `FullScreenCaptureMode` 枚举：定义全屏捕获模式（main, current, all）

### 修改的文件

#### 1. ScreenshotEngine.swift
新增方法：
- `captureFullDisplay(display:)` - 捕获指定显示器
- `captureCurrentDisplay()` - 捕获当前屏幕（鼠标所在）
- `captureAllDisplays()` - 捕获并拼接所有显示器

#### 2. HotKeyManager.swift
- 重构为支持多个热键注册
- 使用 `HotKey` 结构体管理热键信息
- 支持为每个热键指定独立的回调函数
- 添加 `unregister(id:)` 和 `unregisterAll()` 方法

#### 3. ScreenshotSettings.swift
- 添加 `fullScreenCaptureMode` 属性
- 自动持久化到 UserDefaults
- 默认值为 `.currentScreen`

#### 4. AppDelegate.swift
- 注册两个全局热键（区域截图和全屏截图）
- 添加 `handleTriggerFullScreenshot()` 方法
- 添加 `captureFullScreen()` 方法处理全屏截图逻辑
- 根据设置选择相应的捕获模式

#### 5. MenuBarController.swift
- 菜单项从"截图"改为"区域截图"
- 添加"全屏截图"菜单项
- 更新方法名和通知

#### 6. Extensions.swift
- 添加 `.triggerFullScreenshot` 通知名称

#### 7. SettingsView.swift
- 添加"全屏截图设置"区块
- 使用分段控件选择捕获模式
- 添加详细说明文字
- 更新快捷键说明
- 窗口尺寸从 500x400 调整为 550x500

### 测试
新增 **ScreenshotModeTests.swift**：
- 测试枚举的原始值和显示名称
- 测试设置的默认值
- 测试设置的持久化

## 使用流程

### 区域截图流程
1. 用户按下 `⌃⌘A` 或点击菜单"区域截图"
2. 系统捕获当前屏幕作为背景
3. 显示选择窗口
4. 用户拖拽选择区域
5. 按 Enter 确认或 ESC 取消
6. 截图保存到剪贴板（可选保存到文件）

### 全屏截图流程
1. 用户按下 `⇧⌘3` 或点击菜单"全屏截图"
2. 根据设置的模式：
   - 主显示器：捕获主屏幕
   - 当前屏幕：捕获鼠标所在屏幕
   - 所有屏幕：捕获所有屏幕并拼接
3. 截图立即保存到剪贴板（可选保存到文件）
4. 播放快门音效（如果启用）

## 多屏幕拼接算法
当选择"所有屏幕"模式时：
1. 遍历所有显示器，分别截图
2. 计算所有屏幕的边界框（minX, minY, maxX, maxY）
3. 创建足够大的画布容纳所有屏幕
4. 根据每个屏幕的实际坐标位置，将截图绘制到画布上
5. 保持屏幕的相对位置关系

## 注意事项
1. 需要屏幕录制权限才能正常工作
2. 首次使用会提示授权
3. 全屏截图不会显示选择界面，立即执行
4. 所有屏幕模式可能产生较大的图片文件
5. 热键与系统截图快捷键不冲突（系统使用 ⇧⌘4）

## 兼容性
- macOS 14.0 及以上
- 支持 Apple Silicon 和 Intel 处理器
- 自动适配 Retina 显示器的缩放因子

## 未来改进建议
1. 添加延迟截图功能（倒计时 3/5/10 秒）
2. 支持自定义全屏截图热键
3. 添加窗口截图模式（捕获指定窗口）
4. 支持截图后的编辑功能（标注、裁剪等）
5. 添加截图历史记录
